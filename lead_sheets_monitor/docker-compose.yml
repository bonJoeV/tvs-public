services:
  # Main monitor service - runs continuously with --daemon
  sheets-monitor:
    build: .
    container_name: sheets-monitor
    restart: unless-stopped
    env_file: .env
    environment:
      - SENT_TRACKER_FILE=/data/sent_entries.json
      - LOG_DIR=/data/logs
      - CONFIG_FILE=/app/config.json
    volumes:
      - ./data:/data
      - ./config.json:/app/config.json:ro
    command: ["python", "monitor.py", "--daemon", "--verbose"]

  # CLI service - for debugging and one-off runs
  sheets-monitor-cli:
    build: .
    container_name: sheets-monitor-cli
    profiles: ["cli"]
    env_file: .env
    environment:
      - SENT_TRACKER_FILE=/data/sent_entries.json
      - LOG_DIR=/data/logs
      - CONFIG_FILE=/app/config.json
    volumes:
      - ./data:/data
      - ./config.json:/app/config.json:ro
    command: ["python", "monitor.py", "--dry-run", "--verbose"]
