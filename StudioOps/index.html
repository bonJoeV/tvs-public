<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Vital Stretch - Analytics Dashboard</title>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Yeseva+One&display=swap" rel="stylesheet">
    
    <!-- External Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    
    <!-- Dashboard Styles -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Settings Button -->
    <button class="settings-btn" id="settingsBtn">âš™ï¸ Features</button>
    
    <!-- Settings Panel -->
    <div class="settings-panel" id="settingsPanel">
        <!-- Populated by JavaScript -->
    </div>
    
    <!-- Dashboard Header -->
    <div class="dashboard-header">
        <div class="header-content">
            <div style="display: flex; align-items: center; gap: 20px;">
                <div style="width: 80px; height: 80px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; color: #013160; font-size: 24px;">TVS</div>
                <div>
                    <h1>The Vital Stretch</h1>
                    <p class="tagline">Operational Insights</p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="container">
        <!-- Upload Section - Enhanced with Two Uploads -->
        <div class="upload-section">
            <h2>Upload Your Data</h2>
            <p style="margin: 15px 0; color: #666;">Upload CSV exports from Momence to start analyzing</p>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                <!-- Appointments Upload -->
                <div>
                    <h3 style="font-size: 16px; margin-bottom: 10px;">ğŸ“… Appointments Data</h3>
                    <input type="file" id="csvFileInput" accept=".csv" style="display: none;">
                    <label for="csvFileInput" class="upload-btn">ğŸ“‚ Choose Appointments CSV</label>
                    <p id="uploadStatus" style="margin-top: 10px; font-size: 14px;"></p>
                </div>
                
                <!-- Leads/Customers Upload -->
                <div>
                    <h3 style="font-size: 16px; margin-bottom: 10px;">ğŸ‘¥ Leads & Customers Data</h3>
                    <input type="file" id="leadsFileInput" accept=".csv" style="display: none;">
                    <label for="leadsFileInput" class="upload-btn">ğŸ“‚ Choose Leads/Customers CSV</label>
                    <p id="leadsUploadStatus" style="margin-top: 10px; font-size: 14px;"></p>
                </div>
            </div>
            
            <div id="mergeStatus" style="margin-top: 15px; padding: 15px; background: #e8f4f8; border-radius: 8px; display: none;">
                <strong>ğŸ”— Data Merge Status:</strong>
                <span id="mergeStatusText"></span>
            </div>
        </div>
        
        <!-- Filters -->
        <div class="filters">
            <h2>Filters</h2>
            <div class="filter-grid">
                <div class="filter-group">
                    <label for="monthFilter">Month</label>
                    <select id="monthFilter">
                        <option value="all">All Months</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="locationFilter">Location</label>
                    <select id="locationFilter">
                        <option value="all">All Locations</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="practitionerFilter">Practitioner</label>
                    <select id="practitionerFilter">
                        <option value="all">All Practitioners</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="serviceFilter">Service</label>
                    <select id="serviceFilter">
                        <option value="all">All Services</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="startDate">Start Date</label>
                    <input type="date" id="startDate">
                </div>
                <div class="filter-group">
                    <label for="endDate">End Date</label>
                    <input type="date" id="endDate">
                </div>
            </div>
            <div class="quick-filters">
                <button class="quick-filter-btn" data-days="7">Last 7 Days</button>
                <button class="quick-filter-btn" data-days="30">Last 30 Days</button>
                <button class="quick-filter-btn" data-days="90">Last 90 Days</button>
                <button class="quick-filter-btn" data-month="current">This Month</button>
                <button class="quick-filter-btn" data-month="last">Last Month</button>
            </div>
        </div>
        
        <!-- Main Tabs -->
        <div class="tabs">
            <div class="tab active" data-tab="overview">ğŸ“Š Overview</div>
            <div class="tab" data-tab="customers">ğŸ‘¥ Customers</div>
            <div class="tab" data-tab="timeline">ğŸ“ˆ Timeline</div>
            <div class="tab" data-tab="practitioners">âš•ï¸ Practitioners</div>
            <div class="tab" data-tab="instructions">ğŸ“‹ Instructions</div>
        </div>
        
        <!-- Tab Contents -->
        <div id="overview" class="tab-content active">
            <div class="metrics-grid" id="overviewMetrics"></div>
            
            <div class="charts-grid">
                <div class="chart-container">
                    <h2>Revenue by Location</h2>
                    <div class="chart-wrapper">
                        <canvas id="revenueByLocationChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-container">
                    <h2>Revenue by Service</h2>
                    <div class="chart-wrapper">
                        <canvas id="revenueByServiceChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-container">
                    <h2>Introductory Offers</h2>
                    <div class="chart-wrapper">
                        <canvas id="introOffersChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- Feature Sections in Overview -->
            <div id="heatmapSection" class="feature-section" data-feature="heatmap">
                <div class="table-container">
                    <h2>ğŸ”¥ Appointment Heatmap</h2>
                    <p style="margin-bottom: 15px; color: #666;">See your busiest appointment times at a glance</p>
                    <div id="heatmapContainer"></div>
                </div>
            </div>
            
            <div id="clientRetentionSection" class="feature-section" data-feature="clientRetention">
                <div class="table-container">
                    <h2>ğŸ‘¥ Client Retention Analysis</h2>
                    <div id="clientRetentionContainer">
                        <p>Client retention analysis will appear here once enabled.</p>
                    </div>
                </div>
            </div>
            
            <div id="scheduleOptimizationSection" class="feature-section" data-feature="scheduleOptimization">
                <div class="table-container">
                    <h2>â° Schedule Optimization</h2>
                    <div id="scheduleOptContainer">
                        <p>Schedule optimization analysis will appear here once enabled.</p>
                    </div>
                </div>
            </div>
            
            <div id="goalsSection" class="feature-section" data-feature="goals">
                <div class="table-container">
                    <h2>ğŸ¯ Goal Tracking</h2>
                    <div id="goalsContent"></div>
                </div>
            </div>
            
            <div id="alertsSection" class="feature-section" data-feature="alerts">
                <div class="table-container">
                    <h2>ğŸš¨ Smart Alerts</h2>
                    <div id="alertsContent"></div>
                </div>
            </div>
            
            <div id="exportSection" class="feature-section" data-feature="export">
                <div class="table-container">
                    <h2>ğŸ“¤ Export Tools</h2>
                    <p style="margin-bottom: 20px; color: #666;">Download your filtered data or print the dashboard</p>
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <button class="upload-btn" onclick="exportToCSV()">ğŸ“Š Export to CSV</button>
                        <button class="upload-btn" onclick="window.print()">ğŸ–¨ï¸ Print Dashboard</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- NEW: Customers Tab -->
        <div id="customers" class="tab-content">
            <div id="ltvSection">
                <h2>ğŸ’° Customer Lifetime Value</h2>
                <div class="metrics-grid" id="ltvMetrics"></div>
                
                <div class="charts-grid">
                    <div class="chart-container">
                        <h2>LTV Distribution</h2>
                        <div class="chart-wrapper">
                            <canvas id="ltvDistributionChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <h2>First Purchase Analysis</h2>
                        <div class="chart-wrapper">
                            <canvas id="firstPurchaseChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="conversionSection">
                <h2>ğŸ¯ Lead Conversion Funnel</h2>
                <div id="conversionFunnelContainer"></div>
            </div>
            
            <div id="zeroLtvSection">
                <h2>âš ï¸ Revenue Opportunity</h2>
                <div id="zeroLtvAlertContainer"></div>
            </div>
            
            <div id="topCustomersSection">
                <h2>ğŸ‘‘ Top Customers</h2>
                <div id="topCustomersContainer"></div>
            </div>
            
            <div id="customerSegmentationSection">
                <h2>ğŸ‘¥ Customer Segmentation</h2>
                <div id="customerSegmentationContainer"></div>
            </div>
        </div>
        
        <div id="timeline" class="tab-content">
            <div class="metrics-grid" id="timelineMetrics"></div>
            <div class="charts-grid">
                <div class="chart-container full-width">
                    <h2>Daily Revenue Trend</h2>
                    <div class="chart-wrapper">
                        <canvas id="dailyRevenueChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-container full-width">
                    <h2>Daily Appointment Count</h2>
                    <div class="chart-wrapper">
                        <canvas id="appointmentsTrendChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="practitioners" class="tab-content">
            <div class="table-container" id="practitionersTable"></div>
            
            <div class="charts-grid">
                <div class="chart-container">
                    <h2>Revenue by Practitioner</h2>
                    <div class="chart-wrapper">
                        <canvas id="practitionerRevenueChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Instructions Tab -->
        <div id="instructions" class="tab-content">
            <div class="table-container">
                <h2>ğŸ“‹ Dashboard Instructions</h2>
                
                <div style="margin: 20px 0;">
                    <h3 style="color: #013160; margin-bottom: 10px;">Getting Started</h3>
                    <ol style="line-height: 1.8; margin-left: 20px;">
                        <li><strong>Upload Your Data:</strong> Upload both CSV files - Appointments and Leads/Customers</li>
                        <li><strong>Apply Filters:</strong> Use the filter dropdowns to narrow down your data</li>
                        <li><strong>Explore Tabs:</strong> Navigate between Overview, Customers, Timeline, and Practitioners</li>
                        <li><strong>Enable Features:</strong> Click "âš™ï¸ Features" to toggle additional analysis tools</li>
                    </ol>
                </div>
                
                <div style="margin: 30px 0;">
                    <h3 style="color: #013160; margin-bottom: 10px;">Dashboard Tabs</h3>
                    
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h4 style="margin: 0 0 10px 0;">ğŸ“Š Overview Tab</h4>
                        <p style="margin: 5px 0;">View key appointment metrics, revenue charts, and intro offer tracking. All optional features appear here.</p>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h4 style="margin: 0 0 10px 0;">ğŸ‘¥ Customers Tab (NEW!)</h4>
                        <p style="margin: 5px 0;">Customer lifetime value analysis, lead conversion funnel, top customers, and revenue opportunities.</p>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h4 style="margin: 0 0 10px 0;">ğŸ“ˆ Timeline Tab</h4>
                        <p style="margin: 5px 0;">Analyze trends over time with daily revenue and appointment charts.</p>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h4 style="margin: 0 0 10px 0;">âš•ï¸ Practitioners Tab</h4>
                        <p style="margin: 5px 0;">Compare practitioner performance with detailed metrics.</p>
                    </div>
                </div>
                
                <div style="background: #e8f4f8; padding: 20px; border-radius: 8px; border-left: 4px solid #71BED2; margin-top: 30px;">
                    <h4 style="margin: 0 0 10px 0; color: #013160;">ğŸ’¡ Customer Data Insights</h4>
                    <p style="margin: 0;">Upload the Leads & Customers CSV to unlock powerful insights including lifetime value analysis, conversion tracking, and revenue opportunities!</p>
                </div>
            </div>
        </div>
        
    </div>
    
    <!-- Load Scripts in Order -->
    <script src="js/config.js"></script>
    <script src="js/core.js"></script>
    <script src="js/leads.js"></script>
    
    <!-- Feature modules are loaded dynamically by core.js -->
    
</body>
</html>
